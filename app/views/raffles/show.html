{% extends "layouts/base.html" %}

{% block styles %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/raffles/show.css') }}">
{% endblock %}


{% block content %}
<section class="hero is-small is-reddit">
    <div class="hero-body">
        <div class="container has-text-centered">
            <p class="title has-text-light">
                Raffle results for "<a href="https://redd.it/{{ raffle.submission_id }}">{{ raffle.submission_title | truncate(60) | safe }}</a>"
            </p>
            <p id="subtitle" class="subtitle has-text-light">
                Created by
                {% if raffle.creator %}
                    <a href="{{ url_for('users.show', username=raffle.creator.username) }}">/u/{{raffle.creator.username}}</i></a>
                {% else %}
                    an anonymous user
                {% endif %}
                on {{ raffle.created_at_readable() }} UTC
            </p>
            {% if raffle.is_verified() %}
            <p>
                <span id="verified-tag" class="tag is-reddit is-rounded" data-balloon="These results were generated by the author of the Reddit submission." data-balloon-pos="right">
                    Verified Raffle <i class="fas fa-check-circle fa-fw"></i>
                </span>
            </p>
            {% endif %}
        </div>
    </div>
</section>

{% if raffle.submission_id == '4re9cx' or not raffle.is_verified() %}
<div class="banner is-red">
    <div class="container">
        <div class="content has-text-centered">
            <i class="fas fa-2x fa-exclamation-triangle fa-fw"></i>
            {% if raffle.submission_id == '4re9cx' %}
            <p>This is an example raffle created with permission by the submission's author.</p>
            <p>This page does not reflect the true results of this particular giveaway.</p>
            {% else %}
            <p>This raffle is not verified and it may not have been created by the author of the Reddit submission.</p>
            {% endif %}
        </div>
    </div>
</div>
{% endif %}

<section class="section">
    <div class="container">
        <div class="content has-text-centered">
            <p class="title has-text-reddit">Criteria</p>
        </div>
        <div class="columns is-centered">
            <div class="column">
                <div class="has-text-centered">
                    <p><i class="fas fa-birthday-cake fa-2x has-text-reddit"></i></p>
                    <p class="is-size-3">{{ raffle.min_account_age }} <span class="is-size-5">day(s)</span></p>
                    <p class="is-size-6">Minimum Account Age</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p><i class="far fa-comments fa-2x has-text-reddit"></i></p>
                    <p class="is-size-3">{{ raffle.min_comment_karma }}</p>
                    <p class="is-size-6">Minimum Comment Karma</p>
                </div>
            </div>
            <div class="column">
                <div class="has-text-centered">
                    <p><i class="fas fa-link fa-2x has-text-reddit"></i></p>
                    <p class="is-size-3">{{ raffle.min_link_karma }}</p>
                    <p class="is-size-6">Minimum Link Karma</p>
                </div>
            </div>
        </div>
        {% if raffle.ignored_users %}
        <div class="columns is-centered">
            <div class="column is-half">
                <div class="has-text-centered">
                    <p><i class="fas fa-ban fa-2x has-text-reddit"></i></p>
                    <p class="is-size-3">{{ raffle.ignored_users | length }}</p>
                    <p class="is-size-6">Ignored User(s)</p>
                    <p>
                        {% for user in raffle.ignored_users %}
                        <span class="tag is-reddit is-rounded">
                            {{ user.username }}
                        </span>
                        {% endfor %}
                    </p>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="content has-text-centered">
            <p class="title has-text-reddit">Winners</p>
            <p class="subtitle">
                {% if raffle.winner_count == 1 %}
                1 winner was chosen for this raffle. The winner is...
                {% else %}
                {{ raffle.winner_count }} winners were chosen for this raffle. The winners are...
                {% endif %}
            </p>
        </div>

        {% for row in raffle.winners | sort(attribute='username') | batch(3) %}
        <div class="columns is-centered">
            {% for winner in row %}
            <div class="column is-4">
                <div class="card">
                    <div class="card-content has-text-centered">
                        <p class="is-size-4 has-text-reddit">
                            /u/{{ winner.username }}
                        </p>
                        <p>
                            <a class="reddit-button" href="https://reddit.com/u/{{ winner.username }}"><i class="fas fa-user"></i> Profile</a>
                        </p>
                        <p>
                            <a class="reddit-button" href="{{ winner.comment_url }}"><i class="far fa-comment-alt"></i> Comment</a>
                        </p>
                    </div>
                    <footer class="card-footer">
                        <p class="card-footer-item">
                            <i class="fas fa-birthday-cake fa-fw card-icon"></i> {{ winner.account_age }} days
                        </p>
                        <p class="card-footer-item">
                            <i class="far fa-comments fa-fw card-icon"></i> {{ winner.comment_karma }} karma
                        </p>
                        <p class="card-footer-item">
                            <i class="fas fa-link fa-fw card-icon"></i> {{ winner.link_karma }} karma
                        </p>
                    </footer>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>
</section>
{% endblock %}
